<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restablecer Contraseña - Soundwave</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../assets/logo.ico" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
    <link href="../css/styles.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&display=swap" rel="stylesheet">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            background-color: #0a001f;
            font-family: 'Arial', sans-serif;
        }
        body::after {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50vh;
            background: linear-gradient(to top, #000 0%, rgba(0, 0, 0, 0.7) 25%, rgba(0, 0, 0, 0.3) 50%, rgba(0, 0, 0, 0) 70%, rgba(0, 0, 0, 0) 100%);
            z-index: 0;
            pointer-events: none;
        }
        
        .login-container {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .wave-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('../assets/img/bg-masthead.jpg') no-repeat center center;
            background-size: cover;
            opacity: 0.5;
            z-index: 0;
        }
        
        .login-card {
            background-color: rgba(15, 10, 38, 0.85);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
            z-index: 1;
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 30px 0;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .logo img {
            max-height: 40px;
            width: auto;
        }
        
        .form-control {
            background: rgba(30, 20, 60, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px;
            height: auto;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            background: rgba(40, 30, 80, 0.9);
            border-color: rgba(127, 90, 240, 0.6);
            box-shadow: 0 0 15px rgba(127, 90, 240, 0.4);
            color: white;
        }
        
        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .btn-login {
            background: linear-gradient(135deg, #6b45bc 0%, #9c6fef 100%);
            border: none;
            padding: 10px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: all 0.3s ease;
            margin-top: 5px;
        }
        
        .btn-login:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(156, 111, 239, 0.4);
        }
        
        .login-links {
            text-align: center;
            margin-top: 20px;
        }
        
        .login-links a {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .login-links a:hover {
            color: #9c6fef;
        }
        
        .slogan {
            text-align: center;
            margin-top: 15px;
            color: rgba(255, 255, 255, 0.7);
            font-family: Dancing Script;
            font-size: 18px;
        }
        
        h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        @media (max-width: 576px) {
            .login-card {
                padding: 20px;
                margin: 20px;
                max-height: 80vh;
            }
        }
        
        #message {
            display: none;
            background: rgba(30, 20, 60, 0.8);
            color: #ffffff;
            position: relative;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
        }
        
        #message p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .valid {
            color: #4CAF50;
        }
        
        .invalid {
            color: #f44336;
        }
    </style>
</head>
<body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="../index.html">
                <img id="logo-white" src="../assets/img/logo-white.png" alt="Soundwave" width="100" height="50"> 
                <img id="logo-black" src="../assets/img/logo-black.png" alt="Soundwave" width="100" height="50" style="display: none;">                    
            </a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="masthead">
    <div class="login-container">
        <div class="wave-background"></div>
        
        <div class="login-card">
            <div class="logo">
                <img src="../assets/img/logo-white.png" alt="Soundwave Logo">
            </div>
            
            <h3 class="text-center">Establecer Nueva Contraseña</h3>
            <p class="text-center text-white-50 mb-4">Ingresa y confirma tu nueva contraseña.</p>
            
            <form id="resetForm" method="post" action="../php/reset_password.php">
                <input type="hidden" id="token" name="token" value="">
                
                <div class="mb-3 position-relative">
                    <input type="password" id="password" name="password" class="form-control" placeholder="Nueva contraseña" required pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}">
                    <i class="toggle-password bi bi-eye-slash" onclick="togglePasswordVisibility('password')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;"></i>
                </div>
                
                <div class="mb-3 position-relative">
                    <input type="password" id="confirm_password" name="confirm_password" class="form-control" placeholder="Confirmar contraseña" required>
                    <i class="toggle-password-confirm bi bi-eye-slash" onclick="togglePasswordVisibility('confirm_password')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;"></i>
                </div>
                
                <div id="message">
                    <h4>La contraseña debe contener:</h4>
                    <p id="letter" class="invalid">Una <b>letra minúscula</b></p>
                    <p id="capital" class="invalid">Una <b>letra mayúscula</b></p>
                    <p id="number" class="invalid">Un <b>número</b></p>
                    <p id="length" class="invalid">Mínimo <b>8 caracteres</b></p>
                </div>
                
                <button type="submit" class="btn btn-login w-100">Cambiar contraseña</button>
            </form>
            
            <div class="login-links">
                <a href="login.html">Volver al inicio de sesión</a>
            </div>
            
            <div class="slogan">
                Donde el sonido encuentra significado
            </div>
        </div>
    </div>
</header>

<script>
    // Obtener el token de la URL
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        
        if (token) {
            document.getElementById('token').value = token;
        } else {
            alert('Token no válido o expirado.');
            window.location.href = 'login.html';
        }
    });
    
    // Función para mostrar/ocultar contraseña
    function togglePasswordVisibility(inputId) {
        const passwordInput = document.getElementById(inputId);
        const toggleIcon = inputId === 'password' 
            ? document.querySelector(".toggle-password") 
            : document.querySelector(".toggle-password-confirm");
        
        if (passwordInput.type === "password") {
            passwordInput.type = "text";
            toggleIcon.classList.remove("bi-eye-slash");
            toggleIcon.classList.add("bi-eye");
        } else {
            passwordInput.type = "password";
            toggleIcon.classList.remove("bi-eye");
            toggleIcon.classList.add("bi-eye-slash");
        }
    }
    
    // Validación de contraseña
    const myInput = document.getElementById("password");
    const letter = document.getElementById("letter");
    const capital = document.getElementById("capital");
    const number = document.getElementById("number");
    const length = document.getElementById("length");
    const confirmPassword = document.getElementById("confirm_password");
    
    // Cuando el usuario hace clic en el campo de contraseña, muestra el cuadro de mensaje
    myInput.onfocus = function() {
        document.getElementById("message").style.display = "block";
    }
    
    // Cuando el usuario hace clic fuera del campo de contraseña, oculta el cuadro de mensaje
    myInput.onblur = function() {
        document.getElementById("message").style.display = "none";
    }
    
    // Cuando el usuario comienza a escribir algo en el campo de contraseña
    myInput.onkeyup = function() {
        // Validar letras minúsculas
        const lowerCaseLetters = /[a-z]/g;
        if(myInput.value.match(lowerCaseLetters)) {
            letter.classList.remove("invalid");
            letter.classList.add("valid");
        } else {
            letter.classList.remove("valid");
            letter.classList.add("invalid");
        }
        
        // Validar letras mayúsculas
        const upperCaseLetters = /[A-Z]/g;
        if(myInput.value.match(upperCaseLetters)) {
            capital.classList.remove("invalid");
            capital.classList.add("valid");
        } else {
            capital.classList.remove("valid");
            capital.classList.add("invalid");
        }
        
        // Validar números
        const numbers = /[0-9]/g;
        if(myInput.value.match(numbers)) {
            number.classList.remove("invalid");
            number.classList.add("valid");
        } else {
            number.classList.remove("valid");
            number.classList.add("invalid");
        }
        
        // Validar longitud
        if(myInput.value.length >= 8) {
            length.classList.remove("invalid");
            length.classList.add("valid");
        } else {
            length.classList.remove("valid");
            length.classList.add("invalid");
        }
    }
    
    // Validar que las contraseñas coincidan
    document.getElementById("resetForm").onsubmit = function(e) {
        if (myInput.value !== confirmPassword.value) {
            alert("Las contraseñas no coinciden.");
            e.preventDefault();
            return false;
        }
        return true;
    };
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>